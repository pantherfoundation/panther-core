import * as path from 'path';

import circom_wasm_tester from 'circom_tester';
const wasm_tester = circom_wasm_tester.wasm;

import {getOptions} from './helpers/circomTester';
import {wtns} from 'snarkjs';
import {
    deriveChildPubKeyFromRootPubKey,
    deriveChildPrivKeyFromRootPrivKey,
    deriveKeypairFromSeed,
} from '@panther-core/crypto/lib/base/keypairs';
import {poseidon} from 'circomlibjs';
import {MerkleTree} from '@zk-kit/merkle-tree';

/* START ===== ZAssetUTXO Computation ===== */
const utxoOutSpendPubKeyRandom =
    920916380985300645651724170838735530584359756451808812153292874012653181197n;

const utxoOutDerivedPublicKeys = deriveChildPubKeyFromRootPubKey(
    [
        9665449196631685092819410614052131494364846416353502155560380686439149087040n,
        13931233598534410991314026888239110837992015348186918500560502831191846288865n,
    ],
    920916380985300645651724170838735530584359756451808812153292874012653181197n,
);

// console.log('utxoOutDerivedPublicKeys=>', utxoOutDerivedPublicKeys);
// utxoOutDerivedPublicKeys=> [
//     15734336580112673408042984576472528848602190000152580813394098188809037670623n,
//     5285425932397141815637917447431318745604022207375587781592037140670199615053n
//   ]

// computation of utxoOutCommitment
const hiden_hash = poseidon([
    15734336580112673408042984576472528848602190000152580813394098188809037670623n,
    5285425932397141815637917447431318745604022207375587781592037140670199615053n, // spendPubKeys
    0, // utxoZAsset
    33, // zAccountUtxoInId
    2, // utxoOutOriginNetworkId
    2, // utxoOutTargetNetworkId,
    1700902800, // utxoOutCreateTime - GMT: Sunday, 21 January 2024 09:13:27 // create time changes and hence the commitment should also change.
    1, // zAccountUtxoInZoneId
    1, // utxoOutTargetZoneId
]);

// 10 - utxoOutAmount - 6,4
// 6 for self and 4 for ZAccount2
const hasher = poseidon([6, hiden_hash]);

// 3739750521861146137564008236109239681099326378547174333381546914676317521201n
// console.log('hasher=>', hasher);

const deriveChildPrivKeyForZaccount = deriveChildPrivKeyFromRootPrivKey(
    1364957401031907147846036885962614753763820022581024524807608342937054566107n,
    1215795509656177802870041674430711702496004716229829094660171184836034819583n,
);
// deriveChildPrivKeyForZaccount=> 975266908587054884917759649717404230044328108851369651686436225171239044169n
// console.log('deriveChildPrivKeyForZaccount=>', deriveChildPrivKeyForZaccount);

// ========= For self change transfer + transfer to other ZAccount ================
// First ZAssetUTXO is for another ZAccount
// Second ZAssetUTXO is for self (change to self)

// ===== ZAccount2 Details ==========
// ==== root keys for ZAccount2 ====
const fixedSeedForZAccount2 =
    1089537555807992840535817848246097854733198838018546679062295693424945901635n;

const zAccount2KeyPair = deriveKeypairFromSeed(fixedSeedForZAccount2);
const zAccount2PublicKey = zAccount2KeyPair.publicKey;

// zAccount2PublicKey=> [
//     7267405717214690462613663950148551904542730602525132875613316628228214337830n,
//     7178067554084888592453503935019144981758755967500811678969567533289402266751n
//   ]
// console.log('zAccount2PublicKey=>', zAccount2PublicKey);

const zAccount2PrivateKey = zAccount2KeyPair.privateKey;

// zAccount2PrivateKey=> 1089537555807992840535817848246097854733198838018546679062295693424945901635n
// console.log('zAccount2PrivateKey=>', zAccount2PrivateKey);

// === derive spend public key from root public keys ===
const utxoSpendKeyRandomForUTXO2 =
    2562490915094200461249386117990484388285957402192770226229131740144850347260n;

// 563, 564
const utxoOutSpendPubKeyDeriver = deriveChildPubKeyFromRootPubKey(
    [
        7267405717214690462613663950148551904542730602525132875613316628228214337830n,
        7178067554084888592453503935019144981758755967500811678969567533289402266751n,
    ],
    utxoSpendKeyRandomForUTXO2,
);

// console.log('utxoOutSpendPubKeyDeriver=>', utxoOutSpendPubKeyDeriver);
// utxoOutSpendPubKeyDeriver=> [
//     1763135746942179476496116357965039320288057327600603817801138668830285200381n,
//     14491147694421921980366231038797043374588876703394420455757299509021201508765n
//   ]

// computation of utxoOutCommitment
const hiden_hashForUTXO2 = poseidon([
    1763135746942179476496116357965039320288057327600603817801138668830285200381n,
    14491147694421921980366231038797043374588876703394420455757299509021201508765n, // spendPubKeys
    0, // utxoZAsset
    33, // zAccountUtxoInId
    2, // utxoOutOriginNetworkId
    2, // utxoOutTargetNetworkId,
    1700902800, // utxoOutCreateTime - GMT: Sunday, 21 January 2024 09:13:27 // create time changes and hence the commitment should also change.
    1, // zAccountUtxoInZoneId
    1, // utxoOutTargetZoneId
]);

// hiden_hashForUTXO1=> 12174653776192384986486410929191895660535101724279425034424275110489115954930n
// console.log('hiden_hashForUTXO2=>', hiden_hashForUTXO2);

// UTXOIn is 110 -> 50 to ZAccount2 + 60 to self as change
const hasherForUTXO2 = poseidon([4, hiden_hashForUTXO2]);
// 7997086023193918869594552427438782046977875936981814455068076231423196363947n
// console.log('hasherForUTXO2=>', hasherForUTXO2);
/* END ===== ZAssetUTXO Computation ===== */

/* START ===== State of UTXO tree ===== */
// ZAccountRegistration process will create 1 UTXO i.e ZAccountUTXO
// This will be added to the BUS tree
// Adding ZAccountUTXO created to the BUS tree
const busMerkleTree = new MerkleTree(
    poseidon,
    26,
    BigInt(
        2896678800030780677881716886212119387589061708732637213728415628433288554509n,
    ),
);
// 12604557588521919493356492354767978894799472715473645550898984861352936983014n
// console.log('busUTXOMerkleTree root=>', busMerkleTree.root);

// zAccountUtxoInNoteHasher - 9775219500384962933792568081585395848317570806746644855790488573783186458332n
const ZAccountRegistrationZAccOutUTXO =
    9775219500384962933792568081585395848317570806746644855790488573783186458332n;
const ammVoucherExchangeZAccOutUTXO =
    9801583813274409579839703000557872896423943281169404264890046333778640256067n;
const ammExchangeZAccOutUTXO =
    18175105476890322584485034559689089475598097526056309132759314620620028004517n;
const ammExchangeZAssetOutUTXO =
    10737878881523789962798210406551165807070922751876233837797923419039556051321n;
const depositTxZAccountOutUTXO =
    186692839770280082029534744794227910179413518867095586852939524001158859102n;
const depositTxZAssetOutUTXO =
    19415350603868075586262717582877071671289610526157183329824084311591608122417n;

busMerkleTree.insert(ZAccountRegistrationZAccOutUTXO); // 0
busMerkleTree.insert(ammVoucherExchangeZAccOutUTXO); // 1
busMerkleTree.insert(ammExchangeZAccOutUTXO); // 2
busMerkleTree.insert(ammExchangeZAssetOutUTXO); // 3
busMerkleTree.insert(depositTxZAccountOutUTXO); // 4
busMerkleTree.insert(depositTxZAssetOutUTXO); // 5

// {
//     root: 2055607746961262622160531900196670925756154669401892024081128627049224860438n,
//     leaf: 19415350603868075586262717582877071671289610526157183329824084311591608122417n,
//     siblingNodes: [
//       186692839770280082029534744794227910179413518867095586852939524001158859102n,
//       15915358021544645824948763611506574620607002248967455613245207713011512736724n,
//       3812976779183932130984902152045886285870857404136629139647330085687899647675n,
//       13332607562825133358947880930907706925768730553195841232963500270946125500492n,
//       2602133270707827583410190225239044634523625207877234879733211246465561970688n,
//       19603150025355661252212198237607440386334054455687766589389473805115541553727n,
//       21078238521337523625806977154031988767929399923323679789427062985634312723305n,
//       15530836891415741166399860451702547522959094984965127719828675838122418186767n,
//       17831836427614557290431652044145414371925087626131808598362009890774438652119n,
//       4465836784202878977538296341471470300441964855135851519008900812038788261656n,
//       12878033372712703816810492505815415858124057351499708737135229819203122809944n,
//       18307780612008914306024415546812737365063691384665843671053755584619447524447n,
//       18399220794236723308907532455368503933105202479015828179801520916772962880998n,
//       17997772780903759195601581429183819619412163062353143936165307874482723961709n,
//       18496693394049906980893311686550786982256672525298758106045562727433199943509n,
//       12455859713696229724526221339047857485467607588813434501517928769317308134556n,
//       4689866144310700684516443679096813921756239671572972966393880542662538400201n,
//       15369835007378492529084633432655739856631861107309342928676871259240227049033n,
//       11345121393552856548579926390199540849469635305183604045111689968777651956473n,
//       11299066061427200562963422042645343948885353762628147353062799587547441871332n,
//       13642291777448032365864888577168560039775015251774208221818005338405304930884n,
//       5990068516814370380711726420154273589568095823652643357428323105329308577610n,
//       3326440148296065541386325860294367616471601340115249960006624245213734239367n,
//       17613623862311960463347469460117166104477522402420094872382418386742059442736n,
//       16619835833299406266546819907603615045049052832835825671901337303713338780409n,
//       15002435000641955406214223423745696701460524528446564760654584364314696565951n
//     ],
//     path: [
//       1, 0, 1, 0, 0, 0, 0, 0,
//       0, 0, 0, 0, 0, 0, 0, 0,
//       0, 0, 0, 0, 0, 0, 0, 0,
//       0, 0
//     ]
//   }
// console.log(busMerkleTree.createProof(5));

// {
//     root: 2055607746961262622160531900196670925756154669401892024081128627049224860438n,
//     leaf: 186692839770280082029534744794227910179413518867095586852939524001158859102n,
//     siblingNodes: [
//       19415350603868075586262717582877071671289610526157183329824084311591608122417n,
//       15915358021544645824948763611506574620607002248967455613245207713011512736724n,
//       3812976779183932130984902152045886285870857404136629139647330085687899647675n,
//       13332607562825133358947880930907706925768730553195841232963500270946125500492n,
//       2602133270707827583410190225239044634523625207877234879733211246465561970688n,
//       19603150025355661252212198237607440386334054455687766589389473805115541553727n,
//       21078238521337523625806977154031988767929399923323679789427062985634312723305n,
//       15530836891415741166399860451702547522959094984965127719828675838122418186767n,
//       17831836427614557290431652044145414371925087626131808598362009890774438652119n,
//       4465836784202878977538296341471470300441964855135851519008900812038788261656n,
//       12878033372712703816810492505815415858124057351499708737135229819203122809944n,
//       18307780612008914306024415546812737365063691384665843671053755584619447524447n,
//       18399220794236723308907532455368503933105202479015828179801520916772962880998n,
//       17997772780903759195601581429183819619412163062353143936165307874482723961709n,
//       18496693394049906980893311686550786982256672525298758106045562727433199943509n,
//       12455859713696229724526221339047857485467607588813434501517928769317308134556n,
//       4689866144310700684516443679096813921756239671572972966393880542662538400201n,
//       15369835007378492529084633432655739856631861107309342928676871259240227049033n,
//       11345121393552856548579926390199540849469635305183604045111689968777651956473n,
//       11299066061427200562963422042645343948885353762628147353062799587547441871332n,
//       13642291777448032365864888577168560039775015251774208221818005338405304930884n,
//       5990068516814370380711726420154273589568095823652643357428323105329308577610n,
//       3326440148296065541386325860294367616471601340115249960006624245213734239367n,
//       17613623862311960463347469460117166104477522402420094872382418386742059442736n,
//       16619835833299406266546819907603615045049052832835825671901337303713338780409n,
//       15002435000641955406214223423745696701460524528446564760654584364314696565951n
//     ],
//     path: [
//       0, 0, 1, 0, 0, 0, 0, 0,
//       0, 0, 0, 0, 0, 0, 0, 0,
//       0, 0, 0, 0, 0, 0, 0, 0,
//       0, 0
//     ]
//   }
// console.log(busMerkleTree.createProof(4));
/* END ===== State of UTXO tree ===== */

/* START ===== utxoInSpendPrivKey computation  ===== */
const deriveChildPrivKey = deriveChildPrivKeyFromRootPrivKey(
    1364957401031907147846036885962614753763820022581024524807608342937054566107n,
    94610875299416841087047638331595192377823041951625049650587645487287023247n,
);

// 202861170848353922537340928018493368624870578196892954866307993229949140010n
// console.log('deriveChildPrivKey=>', deriveChildPrivKey);
/* END ===== utxoInSpendPrivKey computation  ===== */

/* START ===== utxoInNullifier computation  ===== */
// poseidon([private key,commitment hash])
const utxoInNullifier = poseidon([
    2081961849142627796057765042284889488177156119328724687723132407819597118232n,
    19415350603868075586262717582877071671289610526157183329824084311591608122417n,
]);

// 6744079633340602015721084589890019091130681888569198412667110032260423776957n
// console.log('utxoInNullifier=>', utxoInNullifier);
/* END ===== utxoInNullifier computation  ===== */

/* START ===== utxoInNullifier computation  ===== */
const zAccountUtxoInNullifierHasher = poseidon([
    2081961849142627796057765042284889488177156119328724687723132407819597118232n,
    186692839770280082029534744794227910179413518867095586852939524001158859102n,
]);

// zAccountUtxoInNullifierHasher=> 16906283694396333336074777357403572581976962800841398906970740932486575302937n
// console.log('zAccountUtxoInNullifierHasher=>', zAccountUtxoInNullifierHasher);
/* END ===== utxoInNullifier computation  ===== */

/* START ===== zAccountUtxoOutCommitment computation  ===== */
const zAccountUtxoOutSpendKeyRandom =
    928974505793416890028255163642163633941110568617692085076073897724890512527n;

// Use the above random to generate a new derived child keys
const derivedPublicKeysUtxoOut = deriveChildPubKeyFromRootPubKey(
    [
        9665449196631685092819410614052131494364846416353502155560380686439149087040n,
        13931233598534410991314026888239110837992015348186918500560502831191846288865n,
    ],
    928974505793416890028255163642163633941110568617692085076073897724890512527n,
);
// derivedPublicKeysUtxoOut=> [
//     15105847820195752209454898940410447097413641188338854293492831210996088086298n,
//     20590113039147987131409464977143724796026066002330149638175405367637371668395n
//   ]
// console.log('derivedPublicKeysUtxoOut=>', derivedPublicKeysUtxoOut);

// Verify zAccountUtxoOut commitment computation - After the internal tx
const hash1 = poseidon([
    15105847820195752209454898940410447097413641188338854293492831210996088086298n,
    20590113039147987131409464977143724796026066002330149638175405367637371668395n,
    9665449196631685092819410614052131494364846416353502155560380686439149087040n,
    13931233598534410991314026888239110837992015348186918500560502831191846288865n,
    1187405049038689339917658225106283881019816002721396510889166170461283567874n,
    311986042833546580202940940143769849297540181368261575540657864271112079432n,
    18636161575160505712724711689946435964943204943778681265331835661113836693938n,
    21369418187085352831313188453068285816400064790476280656092869887652115165947n,
]);

const zAccountUtxoOutCommitment = poseidon([
    hash1,
    407487970930055136132864974074225519407787604125n,
    33,
    9999988200,
    20,
    1,
    1702652400,
    4,
    0,
    1700902800, // same time as zAssetUTXO got created
    2,
]);

// zAccountUtxoOutCommitment=> 6991129837942447437106224885480484531511792005929733215807835310816105473510n
// console.log('zAccountUtxoOutCommitment=>', zAccountUtxoOutCommitment);
/* END ===== zAccountUtxoOutCommitment computation  ===== */

describe('Internal ZAsset transfer - Non ZeroInput - Witness computation', async function (this: any) {
    let circuit: any;
    let mainTxWasm: any;
    let mainTxWitness: any;

    this.timeout(10_000_000);

    before(async () => {
        const opts = getOptions();
        const input = path.join(
            opts.basedir,
            './circuits/mainZTransactionV1.circom',
        );
        circuit = await wasm_tester(input, opts);

        mainTxWasm = path.join(
            opts.basedir,
            './compiled/zTransaction/circuits.wasm',
        );
        mainTxWitness = path.join(
            opts.basedir,
            './compiled/generate_witness.js',
        );
    });

    const singleValidUTXOInternalTxNonZeroInput = {
        extraInputsHash: 0,

        // For internal tx token and tokenId is 0 as there is no external input
        token: 0,
        tokenId: 0,
        zAssetId: 0,
        zAssetToken: 365481738974395054943628650313028055219811856521n,
        zAssetTokenId: 0,
        zAssetOffset: 0,
        // no external deposit
        // no external withdraw
        depositAmount: 0,
        withdrawAmount: 0,
        // Used for both in and out UTXO
        utxoZAsset: 0,

        utxoInAmount: [10, 0],
        utxoOutAmount: [6, 4],

        // zAsset
        zAssetNetwork: 2,
        zAssetWeight: 20,
        zAssetScale: 10 ** 12,
        zAssetMerkleRoot:
            19475268372719999722968422811919514831876197551539186448232606153745317203717n,

        zAssetPathIndices: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        zAssetPathElements: [
            2896678800030780677881716886212119387589061708732637213728415628433288554509n,
            15915358021544645824948763611506574620607002248967455613245207713011512736724n,
            3378776220260879286502089033253596247983977280165117209776494090180287943112n,
            13332607562825133358947880930907706925768730553195841232963500270946125500492n,
            2602133270707827583410190225239044634523625207877234879733211246465561970688n,
            19603150025355661252212198237607440386334054455687766589389473805115541553727n,
            21078238521337523625806977154031988767929399923323679789427062985634312723305n,
            15530836891415741166399860451702547522959094984965127719828675838122418186767n,
            17831836427614557290431652044145414371925087626131808598362009890774438652119n,
            4465836784202878977538296341471470300441964855135851519008900812038788261656n,
            12878033372712703816810492505815415858124057351499708737135229819203122809944n,
            18307780612008914306024415546812737365063691384665843671053755584619447524447n,
            18399220794236723308907532455368503933105202479015828179801520916772962880998n,
            17997772780903759195601581429183819619412163062353143936165307874482723961709n,
            18496693394049906980893311686550786982256672525298758106045562727433199943509n,
            12455859713696229724526221339047857485467607588813434501517928769317308134556n,
        ],

        zAssetIdZkp: 0,
        zAssetTokenZkp: 365481738974395054943628650313028055219811856521n,
        zAssetTokenIdZkp: 0,
        zAssetNetworkZkp: 2,
        zAssetOffsetZkp: 0,
        zAssetWeightZkp: 20,
        zAssetScaleZkp: 10 ** 12,
        zAssetPathIndicesZkp: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        zAssetPathElementsZkp: [
            2896678800030780677881716886212119387589061708732637213728415628433288554509n,
            15915358021544645824948763611506574620607002248967455613245207713011512736724n,
            3378776220260879286502089033253596247983977280165117209776494090180287943112n,
            13332607562825133358947880930907706925768730553195841232963500270946125500492n,
            2602133270707827583410190225239044634523625207877234879733211246465561970688n,
            19603150025355661252212198237607440386334054455687766589389473805115541553727n,
            21078238521337523625806977154031988767929399923323679789427062985634312723305n,
            15530836891415741166399860451702547522959094984965127719828675838122418186767n,
            17831836427614557290431652044145414371925087626131808598362009890774438652119n,
            4465836784202878977538296341471470300441964855135851519008900812038788261656n,
            12878033372712703816810492505815415858124057351499708737135229819203122809944n,
            18307780612008914306024415546812737365063691384665843671053755584619447524447n,
            18399220794236723308907532455368503933105202479015828179801520916772962880998n,
            17997772780903759195601581429183819619412163062353143936165307874482723961709n,
            18496693394049906980893311686550786982256672525298758106045562727433199943509n,
            12455859713696229724526221339047857485467607588813434501517928769317308134556n,
        ],

        forTxReward: 10,
        forUtxoReward: 1828,
        forDepositReward: 57646075,

        // spendTime - time spent by the UTXO in MASP
        // For deposit tx it will be 0 as UTXO created has just moved to MASP.
        // Time spent by the generated UTXO in MASP would be 0
        // But for internal tx, it is not 0 as the valid UTXO already exists in the MASP.
        spendTime: 1705398033, // now time when you are spending the UTXO

        utxoInSpendPrivKey: [
            202861170848353922537340928018493368624870578196892954866307993229949140010n,
            0,
        ],
        utxoInSpendKeyRandom: [
            94610875299416841087047638331595192377823041951625049650587645487287023247n,
            0,
        ],

        // Since the input UTXO is null, other info regarding the input UTXO will be null
        utxoInOriginZoneId: [1, 0],
        utxoInOriginZoneIdOffset: [0, 0],
        utxoInOriginNetworkId: [2, 0],
        utxoInTargetNetworkId: [2, 0],

        utxoInCreateTime: [1700020032, 0],
        utxoInZAccountId: [33, 0],
        utxoInMerkleTreeSelector: [
            [1, 0],
            [0, 0],
        ],
        utxoInPathIndices: [
            [
                1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            ],
            [
                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            ],
        ],
        utxoInPathElements: [
            [
                186692839770280082029534744794227910179413518867095586852939524001158859102n,
                15915358021544645824948763611506574620607002248967455613245207713011512736724n,
                3812976779183932130984902152045886285870857404136629139647330085687899647675n,
                13332607562825133358947880930907706925768730553195841232963500270946125500492n,
                2602133270707827583410190225239044634523625207877234879733211246465561970688n,
                19603150025355661252212198237607440386334054455687766589389473805115541553727n,
                21078238521337523625806977154031988767929399923323679789427062985634312723305n,
                15530836891415741166399860451702547522959094984965127719828675838122418186767n,
                17831836427614557290431652044145414371925087626131808598362009890774438652119n,
                4465836784202878977538296341471470300441964855135851519008900812038788261656n,
                12878033372712703816810492505815415858124057351499708737135229819203122809944n,
                18307780612008914306024415546812737365063691384665843671053755584619447524447n,
                18399220794236723308907532455368503933105202479015828179801520916772962880998n,
                17997772780903759195601581429183819619412163062353143936165307874482723961709n,
                18496693394049906980893311686550786982256672525298758106045562727433199943509n,
                12455859713696229724526221339047857485467607588813434501517928769317308134556n,
                4689866144310700684516443679096813921756239671572972966393880542662538400201n,
                15369835007378492529084633432655739856631861107309342928676871259240227049033n,
                11345121393552856548579926390199540849469635305183604045111689968777651956473n,
                11299066061427200562963422042645343948885353762628147353062799587547441871332n,
                13642291777448032365864888577168560039775015251774208221818005338405304930884n,
                5990068516814370380711726420154273589568095823652643357428323105329308577610n,
                3326440148296065541386325860294367616471601340115249960006624245213734239367n,
                17613623862311960463347469460117166104477522402420094872382418386742059442736n,
                16619835833299406266546819907603615045049052832835825671901337303713338780409n,
                15002435000641955406214223423745696701460524528446564760654584364314696565951n,
                0,
                0,
                0,
                0,
                0,
                0,
            ],
            [
                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            ],
        ],
        utxoInNullifier: [
            6744079633340602015721084589890019091130681888569198412667110032260423776957n,
            0,
        ],

        // input 'zAccount UTXO'
        zAccountUtxoInId: 33,
        zAccountUtxoInZkpAmount: 9999989100,
        zAccountUtxoInPrpAmount: 10,
        zAccountUtxoInZoneId: 1,
        zAccountUtxoInNetworkId: 2,
        zAccountUtxoInExpiryTime: 1702652400,
        zAccountUtxoInNonce: 3,
        zAccountUtxoInTotalAmountPerTimePeriod: 0,
        zAccountUtxoInCreateTime: 1700020032, // creation time of ZAccount
        zAccountUtxoInRootSpendPubKey: [
            9665449196631685092819410614052131494364846416353502155560380686439149087040n,
            13931233598534410991314026888239110837992015348186918500560502831191846288865n,
        ],
        zAccountUtxoInReadPubKey: [
            1187405049038689339917658225106283881019816002721396510889166170461283567874n,
            311986042833546580202940940143769849297540181368261575540657864271112079432n,
        ],
        zAccountUtxoInNullifierPubKey: [
            18636161575160505712724711689946435964943204943778681265331835661113836693938n,
            21369418187085352831313188453068285816400064790476280656092869887652115165947n,
        ],
        zAccountUtxoInMasterEOA:
            407487970930055136132864974074225519407787604125n,
        zAccountUtxoInSpendPrivKey:
            975266908587054884917759649717404230044328108851369651686436225171239044169n,
        zAccountUtxoInReadPrivKey:
            1807143148206188134925427242927492302158087995127931582887251149414169118083n,
        zAccountUtxoInNullifierPrivKey:
            2081961849142627796057765042284889488177156119328724687723132407819597118232n,
        zAccountUtxoInMerkleTreeSelector: [1, 0],
        zAccountUtxoInPathIndices: [
            0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            0, 0, 0, 0, 0, 0, 0, 0, 0,
        ],
        zAccountUtxoInPathElements: [
            19415350603868075586262717582877071671289610526157183329824084311591608122417n,
            15915358021544645824948763611506574620607002248967455613245207713011512736724n,
            3812976779183932130984902152045886285870857404136629139647330085687899647675n,
            13332607562825133358947880930907706925768730553195841232963500270946125500492n,
            2602133270707827583410190225239044634523625207877234879733211246465561970688n,
            19603150025355661252212198237607440386334054455687766589389473805115541553727n,
            21078238521337523625806977154031988767929399923323679789427062985634312723305n,
            15530836891415741166399860451702547522959094984965127719828675838122418186767n,
            17831836427614557290431652044145414371925087626131808598362009890774438652119n,
            4465836784202878977538296341471470300441964855135851519008900812038788261656n,
            12878033372712703816810492505815415858124057351499708737135229819203122809944n,
            18307780612008914306024415546812737365063691384665843671053755584619447524447n,
            18399220794236723308907532455368503933105202479015828179801520916772962880998n,
            17997772780903759195601581429183819619412163062353143936165307874482723961709n,
            18496693394049906980893311686550786982256672525298758106045562727433199943509n,
            12455859713696229724526221339047857485467607588813434501517928769317308134556n,
            4689866144310700684516443679096813921756239671572972966393880542662538400201n,
            15369835007378492529084633432655739856631861107309342928676871259240227049033n,
            11345121393552856548579926390199540849469635305183604045111689968777651956473n,
            11299066061427200562963422042645343948885353762628147353062799587547441871332n,
            13642291777448032365864888577168560039775015251774208221818005338405304930884n,
            5990068516814370380711726420154273589568095823652643357428323105329308577610n,
            3326440148296065541386325860294367616471601340115249960006624245213734239367n,
            17613623862311960463347469460117166104477522402420094872382418386742059442736n,
            16619835833299406266546819907603615045049052832835825671901337303713338780409n,
            15002435000641955406214223423745696701460524528446564760654584364314696565951n,
            0,
            0,
            0,
            0,
            0,
            0,
        ],
        zAccountUtxoInNullifier:
            16906283694396333336074777357403572581976962800841398906970740932486575302937n,

        zAccountBlackListLeaf: 0,
        zAccountBlackListMerkleRoot:
            19217088683336594659449020493828377907203207941212636669271704950158751593251n,
        zAccountBlackListPathElements: [
            0,

            14744269619966411208579211824598458697587494354926760081771325075741142829156n,
            7423237065226347324353380772367382631490014989348495481811164164159255474657n,
            11286972368698509976183087595462810875513684078608517520839298933882497716792n,
            3607627140608796879659380071776844901612302623152076817094415224584923813162n,
            19712377064642672829441595136074946683621277828620209496774504837737984048981n,
            20775607673010627194014556968476266066927294572720319469184847051418138353016n,
            3396914609616007258851405644437304192397291162432396347162513310381425243293n,
            21551820661461729022865262380882070649935529853313286572328683688269863701601n,
            6573136701248752079028194407151022595060682063033565181951145966236778420039n,
            12413880268183407374852357075976609371175688755676981206018884971008854919922n,
            14271763308400718165336499097156975241954733520325982997864342600795471836726n,
            20066985985293572387227381049700832219069292839614107140851619262827735677018n,
            9394776414966240069580838672673694685292165040808226440647796406499139370960n,
            11331146992410411304059858900317123658895005918277453009197229807340014528524n,
            15819538789928229930262697811477882737253464456578333862691129291651619515538n,
        ],

        // zZone
        zZoneOriginZoneIDs: 1,
        zZoneTargetZoneIDs: 1,
        zZoneNetworkIDsBitMap: 5,
        zZoneTrustProvidersMerkleTreeLeafIDsAndRulesList: 1577058395,
        zZoneKycExpiryTime: 10368000,
        zZoneKytExpiryTime: 86400,
        zZoneDepositMaxAmount: 1 * 10 ** 12,
        zZoneWithrawMaxAmount: 1 * 10 ** 12,
        zZoneInternalMaxAmount: 1 * 10 ** 12,
        zZoneMerkleRoot:
            9259525054892838702888137325078221513624475393849614502251135783828764533027n,

        zZonePathElements: [
            2896678800030780677881716886212119387589061708732637213728415628433288554509n,
            15915358021544645824948763611506574620607002248967455613245207713011512736724n,
            3378776220260879286502089033253596247983977280165117209776494090180287943112n,
            13332607562825133358947880930907706925768730553195841232963500270946125500492n,
            2602133270707827583410190225239044634523625207877234879733211246465561970688n,
            19603150025355661252212198237607440386334054455687766589389473805115541553727n,
            21078238521337523625806977154031988767929399923323679789427062985634312723305n,
            15530836891415741166399860451702547522959094984965127719828675838122418186767n,
            17831836427614557290431652044145414371925087626131808598362009890774438652119n,
            4465836784202878977538296341471470300441964855135851519008900812038788261656n,
            12878033372712703816810492505815415858124057351499708737135229819203122809944n,
            18307780612008914306024415546812737365063691384665843671053755584619447524447n,
            18399220794236723308907532455368503933105202479015828179801520916772962880998n,
            17997772780903759195601581429183819619412163062353143936165307874482723961709n,
            18496693394049906980893311686550786982256672525298758106045562727433199943509n,
            12455859713696229724526221339047857485467607588813434501517928769317308134556n,
        ],
        zZonePathIndices: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        zZoneEdDsaPubKey: [
            13969057660566717294144404716327056489877917779406382026042873403164748884885n,
            11069452135192839850369824221357904553346382352990372044246668947825855305207n,
        ],
        zZoneDataEscrowEphemeralRandom:
            790122152066676684676093302872898287841903882354339429497975929636832086290n,

        zZoneDataEscrowEphemeralPubKeyAx:
            8203289148254703516772267706874329469330087297928457772489392227653451244213n,

        zZoneDataEscrowEphemeralPubKeyAy:
            19998992060707539017877331634603765261877243592349009808298088607668947098216n,

        zZoneZAccountIDsBlackList:
            1766847064778384329583297500742918515827483896875618958121606201292619775n,

        zZoneMaximumAmountPerTimePeriod: 1 * 10 ** 13,
        zZoneTimePeriodPerMaximumAmount: 86400,

        zZoneDataEscrowEncryptedMessageAx: [
            2468338014121331792444587249698692818014762050360212301429643474146750905863n,
        ],
        zZoneDataEscrowEncryptedMessageAy: [
            16996420608431036321409292371827871642706083345802290766905570404093710249010n,
        ],

        kytEdDsaPubKey: [
            12245681108156315862721578421537205412164963293078065541324995831326019830563n,
            3850804844767147361944551138681828170238733301762589784617578364038335435190n,
        ],
        kytEdDsaPubKeyExpiryTime: 0, // this must be 0 for internal tx
        trustProvidersMerkleRoot:
            675413191976636849763056983375622181122390331630387511499559599588194530856n,

        kytPathElements: [
            9489899717616586094160199124420951802253527995585848778940667248421979517388n,
            15915358021544645824948763611506574620607002248967455613245207713011512736724n,
            3378776220260879286502089033253596247983977280165117209776494090180287943112n,
            13332607562825133358947880930907706925768730553195841232963500270946125500492n,
            2602133270707827583410190225239044634523625207877234879733211246465561970688n,
            19603150025355661252212198237607440386334054455687766589389473805115541553727n,
            21078238521337523625806977154031988767929399923323679789427062985634312723305n,
            15530836891415741166399860451702547522959094984965127719828675838122418186767n,
            17831836427614557290431652044145414371925087626131808598362009890774438652119n,
            4465836784202878977538296341471470300441964855135851519008900812038788261656n,
            12878033372712703816810492505815415858124057351499708737135229819203122809944n,
            18307780612008914306024415546812737365063691384665843671053755584619447524447n,
            18399220794236723308907532455368503933105202479015828179801520916772962880998n,
            17997772780903759195601581429183819619412163062353143936165307874482723961709n,
            18496693394049906980893311686550786982256672525298758106045562727433199943509n,
            12455859713696229724526221339047857485467607588813434501517928769317308134556n,
        ],
        kytPathIndices: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        kytMerkleTreeLeafIDsAndRulesOffset: 1,

        kytDepositSignedMessagePackageType: 2,
        kytDepositSignedMessageTimestamp: 0,
        kytDepositSignedMessageSender:
            407487970930055136132864974074225519407787604125n,
        kytDepositSignedMessageReceiver:
            0xfdfd920f2152565e9d7b589e4e9faee6699ad4bdn,
        kytDepositSignedMessageToken:
            365481738974395054943628650313028055219811856521n,
        kytDepositSignedMessageSessionId: 3906,
        kytDepositSignedMessageRuleId: 94,
        kytDepositSignedMessageAmount: 10 ** 13,
        kytDepositSignedMessageSigner:
            407487970930055136132864974074225519407787604125n,
        kytDepositSignedMessageHash:
            12430652822179204049648459930173643103691412531741204627747996341696287708858n,

        kytDepositSignature: [
            125900651780005850449659142097177797163902083341236940535757621061776322400n,
            2265391700983385700501511925907744748011622672395003165135798438764179106394n,
            3203146045629976864293827964582387095516496748262949749372450935680951413714n,
        ],

        kytWithdrawSignedMessagePackageType: 2,
        kytWithdrawSignedMessageTimestamp: 0,
        kytWithdrawSignedMessageSender: 0,
        kytWithdrawSignedMessageReceiver: 0,
        kytWithdrawSignedMessageToken: 0,
        kytWithdrawSignedMessageSessionId: 0,
        kytWithdrawSignedMessageRuleId: 0,
        kytWithdrawSignedMessageAmount: 0,
        kytWithdrawSignedMessageSigner: 0,
        kytWithdrawSignedMessageHash: 0,
        kytWithdrawSignature: [0, 0, 0],

        dataEscrowPubKey: [
            6461944716578528228684977568060282675957977975225218900939908264185798821478n,
            6315516704806822012759516718356378665240592543978605015143731597167737293922n,
        ],
        dataEscrowPubKeyExpiryTime: 1735689600,
        dataEscrowEphemeralRandom:
            2508770261742365048726528579942226801565607871885423400214068953869627805520n,

        dataEscrowEphemeralPubKeyAx:
            4301916310975298895721162797900971043392040643140207582177965168853046592976n,

        dataEscrowEphemeralPubKeyAy:
            815388028464849479935447593762613752978886104243152067307597626016673798528n,

        dataEscrowPathElements: [
            691692403787570541002677048455170081661625713855976896409615085264963003363n,
            15915358021544645824948763611506574620607002248967455613245207713011512736724n,
            3378776220260879286502089033253596247983977280165117209776494090180287943112n,
            13332607562825133358947880930907706925768730553195841232963500270946125500492n,
            2602133270707827583410190225239044634523625207877234879733211246465561970688n,
            19603150025355661252212198237607440386334054455687766589389473805115541553727n,
            21078238521337523625806977154031988767929399923323679789427062985634312723305n,
            15530836891415741166399860451702547522959094984965127719828675838122418186767n,
            17831836427614557290431652044145414371925087626131808598362009890774438652119n,
            4465836784202878977538296341471470300441964855135851519008900812038788261656n,
            12878033372712703816810492505815415858124057351499708737135229819203122809944n,
            18307780612008914306024415546812737365063691384665843671053755584619447524447n,
            18399220794236723308907532455368503933105202479015828179801520916772962880998n,
            17997772780903759195601581429183819619412163062353143936165307874482723961709n,
            18496693394049906980893311686550786982256672525298758106045562727433199943509n,
            12455859713696229724526221339047857485467607588813434501517928769317308134556n,
        ],
        dataEscrowPathIndices: [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],

        dataEscrowEncryptedMessageAx: [
            12871439135712262058001002684440962908819002983015508623206745248194094676428n,
            17649508565525646149490081831709238075016262735204387459551254037464412843575n,
            12227073363299195251037485128000497114697943590299538694075533205014999387243n,
            20523581000037863852326059229764216089225350671364692666825542079348693914995n,
            20058208365173064495799589272754730145077697732347939968141812382970083158234n,
            7485968841152493895656497089553504240099780901718732449637765602551466361930n,
            2599524700665098211970414950998625343526254681944203754421758326703076811862n,
            10111252208277412639952069212519398619843785739845429764477305981184709037879n,
            16572342436604101100888297601489738723761436738157149049128997887677376397706n,
            10198561194326239698819628461719301242695255565955862731348998794855632134236n,
        ],
        dataEscrowEncryptedMessageAy: [
            17114886397516225242214463605558970802516242403903915116207133292790211059315n,
            18461456114463982193932594475691038007915584956969015663806450961422396060151n,
            18049945214264841922133824616394758247213808167359557336757506465654215588720n,
            5781176486616316053750229455982357786563481303510351065692534349340256489076n,
            2280312154735058123718565914318549085049756125414025321824404625231474964496n,
            16468547883364713538044894189954086361027909103546443455704058255631259996537n,
            14436062143043352622540236640025234820617043132546712944718710052285834685029n,
            13252232220022782360184572835062206125231203628890354822008510217200639180187n,
            1824500429446682686066486444349153203089721042699339920027542160140521191088n,
            6905592443000412710985184953979207936793165524914582249370241589763679798835n,
        ],
        daoDataEscrowPubKey: [
            6744227429794550577826885407270460271570870592820358232166093139017217680114n,
            12531080428555376703723008094946927789381711849570844145043392510154357220479n,
        ],
        daoDataEscrowEphemeralRandom:
            2486295975768183987242341265649589729082265459252889119245150374183802141273n,
        daoDataEscrowEphemeralPubKeyAx:
            18172727478723733672122242648004425580927771110712257632781054272274332874233n,
        daoDataEscrowEphemeralPubKeyAy:
            18696859439217809465524370245449396885627295546811556940609392448191776076084n,

        daoDataEscrowEncryptedMessageAx: [
            12032028674386602247606112047856619939984457257499437643949614462266665472292n,
        ],
        daoDataEscrowEncryptedMessageAy: [
            10231473684893412031634651500584679273869045480560969585260750474375209497228n,
        ],

        utxoOutCreateTime: 1700902800, // For both the UTXO's the createTime will be the same.
        utxoOutOriginNetworkId: [2, 2],
        utxoOutTargetNetworkId: [2, 2],
        utxoOutTargetZoneId: [1, 1],
        utxoOutTargetZoneIdOffset: [0, 0],
        // random should change
        utxoOutSpendPubKeyRandom: [
            920916380985300645651724170838735530584359756451808812153292874012653181197n, //new random by the sender ZAccount
            2562490915094200461249386117990484388285957402192770226229131740144850347260n,
        ],
        // Same as the zAccountUtxoInRootSpendPubKey because of self transfer
        utxoOutRootSpendPubKey: [
            [
                9665449196631685092819410614052131494364846416353502155560380686439149087040n,
                13931233598534410991314026888239110837992015348186918500560502831191846288865n,
            ],
            [
                7267405717214690462613663950148551904542730602525132875613316628228214337830n,
                7178067554084888592453503935019144981758755967500811678969567533289402266751n,
            ],
        ],
        utxoOutCommitment: [
            3739750521861146137564008236109239681099326378547174333381546914676317521201n,
            7997086023193918869594552427438782046977875936981814455068076231423196363947n,
        ],

        zAccountUtxoOutZkpAmount: 9999988200,
        zAccountUtxoOutSpendKeyRandom:
            928974505793416890028255163642163633941110568617692085076073897724890512527n,

        zAccountUtxoOutCommitment:
            6991129837942447437106224885480484531511792005929733215807835310816105473510n,

        // For better testing choosing chargedAmountZkp and addedAmountZkp >= 10 ** 12
        chargedAmountZkp: 10 ** 15,
        addedAmountZkp: 10 ** 14,

        zNetworkId: 2,
        zNetworkChainId: 80001,
        zNetworkIDsBitMap: 5,
        zNetworkTreeMerkleRoot:
            21448888980709764146265348599357914296432058767851940011937843763756766907579n,

        zNetworkTreePathIndices: [1, 0, 0, 0, 0, 0],
        zNetworkTreePathElements: [
            17570133518121739548964196309665064125657253468811303682702000180123719703330n,
            15915358021544645824948763611506574620607002248967455613245207713011512736724n,
            3378776220260879286502089033253596247983977280165117209776494090180287943112n,
            13332607562825133358947880930907706925768730553195841232963500270946125500492n,
            2602133270707827583410190225239044634523625207877234879733211246465561970688n,
            19603150025355661252212198237607440386334054455687766589389473805115541553727n,
        ],
        staticTreeMerkleRoot:
            16339808351986672048936670193536635492613600168986522206559067967046289908771n,

        forestMerkleRoot: 0,
        taxiMerkleRoot:
            21078238521337523625806977154031988767929399923323679789427062985634312723305n,

        busMerkleRoot:
            2055607746961262622160531900196670925756154669401892024081128627049224860438n,

        ferryMerkleRoot:
            16585547643065588372010718035675163508420403417446192422307560350739915741648n,

        // salt
        salt: 0,
        saltHash: 0,

        // magical constraint - groth16 attack: https://geometry.xyz/notebook/groth16-malleability
        magicalConstraint: 0,

        // 0 - has to be zero, it's a bug, change the value once the bug is fixed.
        depositChange: 0,
        withdrawChange: 0,
    };

    it('should compute valid witness for internal transfer of zAsset UTXO (split)', async () => {
        await wtns.calculate(
            singleValidUTXOInternalTxNonZeroInput,
            mainTxWasm,
            mainTxWitness,
            null,
        );
        console.log('Witness calculation successful!');
    });
});
